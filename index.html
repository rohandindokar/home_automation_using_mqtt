<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AetherHome Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-blue: #3A6DFF;
            --primary-violet: #8F8CFF;
            --off-white: #F5F7FA;
            --graphite: #1F1F24;
            --cyan-glow: #4FF2D1;
            --success: #40D486;
            --warning: #FFB95A;
            --error: #FF5E78;
        }
        body { background: linear-gradient(135deg, #1F1F24, #3A3A4A); }
        .gradient-aether { background: linear-gradient(135deg, #3A6DFF, #8F8CFF); }
        .gradient-glow { background: linear-gradient(135deg, #8F8CFF, #4FF2D1); }
        .text-gradient { background: linear-gradient(135deg, #3A6DFF, #8F8CFF); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .card { background: rgba(31, 31, 36, 0.8); backdrop-filter: blur(20px); border: 1px solid rgba(143, 140, 255, 0.15); }
        .card:hover { border-color: rgba(143, 140, 255, 0.4); box-shadow: 0 0 40px rgba(58, 109, 255, 0.15); }
        .glow-cyan { filter: drop-shadow(0 0 20px #4FF2D1); }
        .glow-violet { filter: drop-shadow(0 0 15px #8F8CFF); }
        .glow-amber { filter: drop-shadow(0 0 20px #FFB95A); }
        @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes pulse-glow { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .animate-spin-slow { animation: spin-slow 3s linear infinite; }
        .animate-spin-fast { animation: spin-slow 0.5s linear infinite; }
        .animate-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .animate-float { animation: float 3s ease-in-out infinite; }
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%; background: linear-gradient(135deg, #3A6DFF, #8F8CFF); margin-top: -7px; cursor: pointer; box-shadow: 0 0 10px rgba(58, 109, 255, 0.5); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: rgba(143, 140, 255, 0.2); border-radius: 2px; }
        .toggle-track { background: rgba(143, 140, 255, 0.2); }
        .toggle-track-active { background: linear-gradient(135deg, #3A6DFF, #8F8CFF); }
        .input-field { background: rgba(31, 31, 36, 0.6); border: 1px solid rgba(143, 140, 255, 0.2); }
        .input-field:focus { border-color: #3A6DFF; box-shadow: 0 0 15px rgba(58, 109, 255, 0.3); }
        .btn-primary { background: linear-gradient(135deg, #3A6DFF, #8F8CFF); }
        .btn-primary:hover { box-shadow: 0 0 25px rgba(58, 109, 255, 0.5); transform: translateY(-2px); }
        .btn-danger { background: linear-gradient(135deg, #FF5E78, #FF8A9B); }
        .status-dot { box-shadow: 0 0 10px currentColor; }
    </style>
</head>
<body class="text-gray-100 font-sans min-h-screen flex flex-col">
    <!-- Navbar -->
    <nav class="bg-[#1F1F24]/90 backdrop-blur-xl border-b border-[#8F8CFF]/10 p-4 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-xl gradient-aether flex items-center justify-center">
                    <i class="fa-solid fa-house-signal text-white text-lg"></i>
                </div>
                <h1 class="text-xl font-bold tracking-tight">Aether<span class="text-gradient">Home</span></h1>
            </div>
            <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-2 bg-[#1F1F24] px-3 py-1.5 rounded-full border border-[#8F8CFF]/20">
                    <div id="status-dot" class="w-2.5 h-2.5 rounded-full bg-[#FF5E78] status-dot transition-all"></div>
                    <span id="status-text" class="text-xs font-medium text-gray-400">Disconnected</span>
                </div>
                <button onclick="toggleSettings()" class="w-9 h-9 rounded-xl bg-[#1F1F24] border border-[#8F8CFF]/20 flex items-center justify-center hover:border-[#8F8CFF]/50 transition-all">
                    <i class="fa-solid fa-gear text-gray-400 hover:text-[#8F8CFF] transition"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Settings Panel -->
    <div id="settings-panel" class="hidden bg-[#1F1F24]/95 backdrop-blur-xl border-b border-[#8F8CFF]/10 p-6">
        <div class="max-w-6xl mx-auto">
            <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-4">Connection Settings</h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                <div class="md:col-span-2">
                    <label class="block text-xs font-medium text-gray-500 mb-2">Broker Host</label>
                    <input type="text" id="mqtt-host" value="af3ea6f8e14447d8a93bae9f7b761b26.s1.eu.hivemq.cloud" class="input-field w-full p-3 rounded-xl text-sm text-gray-200 outline-none transition-all">
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-500 mb-2">Port (WSS)</label>
                    <input type="number" id="mqtt-port" value="8884" class="input-field w-full p-3 rounded-xl text-sm text-gray-200 outline-none transition-all">
                </div>
                <div></div>
                <div>
                    <label class="block text-xs font-medium text-gray-500 mb-2">Username</label>
                    <input type="text" id="mqtt-username" placeholder="HiveMQ User" class="input-field w-full p-3 rounded-xl text-sm text-gray-200 outline-none transition-all">
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-500 mb-2">Password</label>
                    <input type="password" id="mqtt-password" placeholder="HiveMQ Password" class="input-field w-full p-3 rounded-xl text-sm text-gray-200 outline-none transition-all">
                </div>
                <button id="connect-btn" onclick="connectMQTT()" class="btn-primary text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300">Connect</button>
            </div>
            <p class="mt-4 text-xs text-[#FFB95A]"><i class="fa-solid fa-circle-info mr-1"></i> HiveMQ Cloud requires credentials from the Access Management tab.</p>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-grow p-6">
        <div class="max-w-6xl mx-auto">
            <div class="mb-8">
                <h2 class="text-2xl font-bold mb-1">Welcome Home</h2>
                <p class="text-gray-500 text-sm">Control your smart devices from one place</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Door Control -->
                <div class="card rounded-3xl p-6 transition-all duration-500">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <span class="text-xs font-semibold text-[#8F8CFF] uppercase tracking-wider">Servo</span>
                            <h3 class="text-lg font-bold text-white mt-1">Main Door</h3>
                        </div>
                        <div class="w-10 h-10 rounded-xl bg-[#8F8CFF]/10 flex items-center justify-center">
                            <i class="fa-solid fa-lock text-[#8F8CFF]"></i>
                        </div>
                    </div>
                    <div class="h-36 flex items-center justify-center mb-6">
                        <i id="door-icon" class="fa-solid fa-door-closed text-7xl text-gray-600 transition-all duration-500"></i>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="controlDevice('door', 'OPEN')" class="flex-1 bg-[#8F8CFF]/10 hover:bg-[#8F8CFF] text-[#8F8CFF] hover:text-white py-3 rounded-xl font-semibold transition-all duration-300">Open</button>
                        <button onclick="controlDevice('door', 'CLOSE')" class="flex-1 bg-gray-700/30 hover:bg-gray-600 text-gray-400 hover:text-white py-3 rounded-xl font-semibold transition-all duration-300">Close</button>
                    </div>
                    <p id="door-status" class="mt-4 text-center text-sm text-gray-500">Status: Closed</p>
                </div>

                <!-- Light Control -->
                <div class="card rounded-3xl p-6 transition-all duration-500">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <span class="text-xs font-semibold text-[#FFB95A] uppercase tracking-wider">LED</span>
                            <h3 class="text-lg font-bold text-white mt-1">Living Room</h3>
                        </div>
                        <div class="w-10 h-10 rounded-xl bg-[#FFB95A]/10 flex items-center justify-center">
                            <i class="fa-solid fa-sun text-[#FFB95A]"></i>
                        </div>
                    </div>
                    <div class="h-36 flex items-center justify-center mb-6">
                        <i id="light-icon" class="fa-solid fa-lightbulb text-7xl text-gray-600 transition-all duration-300"></i>
                    </div>
                    <div class="flex items-center justify-center">
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="light-toggle" class="sr-only peer" onchange="toggleLight(this)">
                            <div class="w-16 h-8 toggle-track rounded-full peer peer-checked:toggle-track-active after:content-[''] after:absolute after:top-1 after:left-1 after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:after:translate-x-8 after:shadow-lg"></div>
                            <span class="ml-4 text-sm font-semibold text-gray-400" id="light-label">OFF</span>
                        </label>
                    </div>
                </div>

                <!-- Fan Control with Speed -->
                <div class="card rounded-3xl p-6 transition-all duration-500">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <span class="text-xs font-semibold text-[#4FF2D1] uppercase tracking-wider">PWM</span>
                            <h3 class="text-lg font-bold text-white mt-1">Ceiling Fan</h3>
                        </div>
                        <div class="w-10 h-10 rounded-xl bg-[#4FF2D1]/10 flex items-center justify-center">
                            <i class="fa-solid fa-wind text-[#4FF2D1]"></i>
                        </div>
                    </div>
                    <div class="h-36 flex items-center justify-center mb-6">
                        <i id="fan-icon" class="fa-solid fa-fan text-7xl text-gray-600 transition-all"></i>
                    </div>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-sm font-medium text-gray-400">Power</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="fan-toggle" class="sr-only peer" onchange="toggleFan(this)">
                                <div class="w-12 h-6 toggle-track rounded-full peer peer-checked:bg-[#4FF2D1] after:content-[''] after:absolute after:top-0.5 after:left-0.5 after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-6 after:shadow-lg"></div>
                            </label>
                        </div>
                        <div>
                            <div class="flex justify-between text-xs text-gray-500 mb-2">
                                <span>Speed</span>
                                <span id="speed-val" class="text-[#4FF2D1] font-semibold">0%</span>
                            </div>
                            <input type="range" id="fan-slider" min="0" max="255" value="0" class="w-full cursor-pointer disabled:opacity-30" disabled oninput="updateFanSpeed(this.value)" onchange="sendFanSpeed(this.value)">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Console -->
    <div class="bg-[#1F1F24] border-t border-[#8F8CFF]/10 p-4 text-xs font-mono h-28 overflow-y-auto" id="console-log">
        <div class="text-gray-600"><span class="text-[#4FF2D1]">→</span> System initialized. Configure connection settings to begin.</div>
    </div>

    <script>
        const TOPICS = { 
            door: "home/livingroom/door/set", 
            light: "home/livingroom/light/set", 
            fanPower: "home/livingroom/fan/set",
            fanSpeed: "home/livingroom/fan/speed/set"
        };
        let client = null;

        function connectMQTT() {
            const host = document.getElementById('mqtt-host').value, port = Number(document.getElementById('mqtt-port').value), user = document.getElementById('mqtt-username').value, pass = document.getElementById('mqtt-password').value, clientId = "aether_" + Math.random().toString(16).substr(2, 8);
            if(!user || !pass) { alert("HiveMQ Cloud requires Username and Password."); return; }
            log(`Connecting to wss://${host}:${port}/mqtt...`);
            client = new Paho.MQTT.Client(host, port, "/mqtt", clientId);
            client.onConnectionLost = onConnectionLost;
            client.onMessageArrived = onMessageArrived;
            client.connect({ onSuccess: onConnect, onFailure: onFail, useSSL: true, userName: user, password: pass, keepAliveInterval: 30 });
            document.getElementById('connect-btn').innerText = "Connecting...";
            document.getElementById('connect-btn').disabled = true;
        }

        function onConnect() {
            log("Connected to HiveMQ Cloud!");
            updateStatus(true);
            const btn = document.getElementById('connect-btn');
            btn.innerText = "Disconnect"; btn.onclick = disconnectMQTT; btn.disabled = false;
            btn.classList.remove('btn-primary'); btn.classList.add('btn-danger');
            ['mqtt-host','mqtt-port','mqtt-username','mqtt-password'].forEach(id => document.getElementById(id).disabled = true);
        }

        function onFail(r) { log("Connection failed: " + r.errorMessage); document.getElementById('connect-btn').innerText = "Connect"; document.getElementById('connect-btn').disabled = false; }
        function onConnectionLost(r) { if(r.errorCode !== 0) log("Connection lost: " + r.errorMessage); updateStatus(false); resetConnectBtn(); }
        function disconnectMQTT() { if(client) { client.disconnect(); log("Disconnected"); } }
        function onMessageArrived(m) { log("Received: " + m.payloadString + " [" + m.destinationName + "]"); }

        function publish(topic, payload) {
            if(!client || !client.isConnected()) { log("Error: Not connected!"); alert("Connect to broker first."); return; }
            const msg = new Paho.MQTT.Message(payload); msg.destinationName = topic; client.send(msg);
            log(`Published: "${payload}" → ${topic}`);
        }

        function controlDevice(device, action) {
            const icon = document.getElementById('door-icon'), status = document.getElementById('door-status');
            if(device === 'door') {
                publish(TOPICS.door, action);
                if(action === 'OPEN') { icon.classList.remove('fa-door-closed','text-gray-600'); icon.classList.add('fa-door-open','text-[#8F8CFF]','glow-violet'); status.innerText = "Status: Open"; }
                else { icon.classList.remove('fa-door-open','text-[#8F8CFF]','glow-violet'); icon.classList.add('fa-door-closed','text-gray-600'); status.innerText = "Status: Closed"; }
            }
        }

        function toggleLight(cb) {
            const payload = cb.checked ? "ON" : "OFF", icon = document.getElementById('light-icon'), label = document.getElementById('light-label');
            publish(TOPICS.light, payload);
            if(cb.checked) { icon.classList.add('text-[#FFB95A]','glow-amber'); icon.classList.remove('text-gray-600'); label.innerText = "ON"; label.classList.add('text-[#FFB95A]'); }
            else { icon.classList.remove('text-[#FFB95A]','glow-amber'); icon.classList.add('text-gray-600'); label.innerText = "OFF"; label.classList.remove('text-[#FFB95A]'); }
        }

        function toggleFan(cb) {
            const payload = cb.checked ? "ON" : "OFF";
            const icon = document.getElementById('fan-icon');
            const slider = document.getElementById('fan-slider');
            
            publish(TOPICS.fanPower, payload);
            
            if(cb.checked) {
                icon.classList.add('text-[#4FF2D1]','animate-spin-slow','glow-cyan');
                icon.classList.remove('text-gray-600');
                slider.disabled = false;
                // Send current speed value when turning on
                if(slider.value > 0) {
                    sendFanSpeed(slider.value);
                }
            } else {
                icon.classList.remove('text-[#4FF2D1]','animate-spin-slow','animate-spin-fast','glow-cyan');
                icon.classList.add('text-gray-600');
                slider.disabled = true;
            }
        }

        function updateFanSpeed(val) {
            const percentage = Math.round((val/255)*100);
            document.getElementById('speed-val').innerText = percentage + "%";
            
            const icon = document.getElementById('fan-icon');
            if(val > 150) {
                icon.classList.remove('animate-spin-slow');
                icon.classList.add('animate-spin-fast');
            } else if(val > 0) {
                icon.classList.remove('animate-spin-fast');
                icon.classList.add('animate-spin-slow');
            }
        }

        function sendFanSpeed(val) {
            publish(TOPICS.fanSpeed, val.toString());
            updateFanSpeed(val);
        }

        function toggleSettings() { document.getElementById('settings-panel').classList.toggle('hidden'); }

        function updateStatus(connected) {
            const dot = document.getElementById('status-dot'), text = document.getElementById('status-text');
            if(connected) { dot.style.background = '#40D486'; text.innerText = "Connected"; text.classList.add('text-[#40D486]'); }
            else { dot.style.background = '#FF5E78'; text.innerText = "Disconnected"; text.classList.remove('text-[#40D486]'); }
        }

        function resetConnectBtn() {
            const btn = document.getElementById('connect-btn');
            btn.innerText = "Connect"; btn.onclick = connectMQTT; btn.classList.add('btn-primary'); btn.classList.remove('btn-danger');
            ['mqtt-host','mqtt-port','mqtt-username','mqtt-password'].forEach(id => document.getElementById(id).disabled = false);
        }

        function log(msg) {
            const c = document.getElementById('console-log'), t = new Date().toLocaleTimeString();
            c.innerHTML += `<div><span class="text-gray-600">[${t}]</span> <span class="text-[#4FF2D1]">→</span> ${msg}</div>`;
            c.scrollTop = c.scrollHeight;
        }
    </script>
</body>
</html>